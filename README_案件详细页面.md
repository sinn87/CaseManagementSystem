# CaseManagementSystem - 案件详细页面功能

## 功能概述

案件详细页面是CaseManagementSystem系统的核心功能模块，是一个功能完整的案件管理系统，支持案件的阅览、编辑、审查、导出、中止和终了等多种状态。系统采用分层架构设计，具有良好的扩展性和维护性。

## 主要功能

### 1. 案件详细页面 (CaseDetailForm)
- **6种状态模式：**
  - 阅览模式：只读显示，蓝色样式
  - 编辑模式：可编辑，支持保存和提交审查
  - 审查模式：淡紫色，支持同意/不同意操作
  - 导出模式：支持Excel和PDF导出
  - 中止模式：显示中止信息，支持恢复
  - 终了模式：所有Tab同意后可终了

- **9个信息标签页：**
  - 基本信息：案件编号、名称、申请日期等
  - 产品信息：产品代码、名称、类型等
  - 技术参数：技术标准、主要参数等
  - 质量标准：质量标准、检验方法等
  - 生产信息：生产厂家、地址、能力等
  - 检验信息：检验机构、结果、报告等
  - 包装信息：包装方式、材料、规格等
  - 备注信息：案件备注
  - 履历信息：审查历史记录

### 2. 案件一览页面 (CaseListForm)
- 显示所有案件列表
- 多条件搜索功能
- 双击打开案件详细页面
- 中止案件红色标记显示

### 3. 案件新录入 (CaseDetailEntryForm)
- 新建案件数据录入
- 9个标签页数据收集
- 自动保存和审查流程

## 系统架构

### 分层设计
1. **窗体层 (Forms)**：负责界面显示和用户交互
2. **业务逻辑层 (BusinessLogic)**：处理业务规则和流程控制
3. **数据访问层 (DataAccess)**：负责数据库操作
4. **模型层 (Models)**：定义数据实体
5. **工具类 (Utils)**：提供通用功能

### 核心文件说明
- `CaseDetailForm.vb` - 案件详细页面主窗体
- `CaseManager.vb` - 案件管理业务逻辑
- `CaseRepository.vb` - 案件数据访问
- `CaseInfo.vb` - 案件信息实体
- `CaseDetail.vb` - 案件详细信息实体
- `ReviewLog.vb` - 审查记录实体

## 使用流程

### 1. 查看案件详情
1. 从主页面点击"案件一览"
2. 在案件列表中找到目标案件
3. 双击案件行打开详细页面
4. 默认进入阅览模式

### 2. 编辑案件信息
1. 在案件详细页面点击"编辑"按钮
2. 切换到编辑模式，控件变为可编辑
3. 修改相关信息
4. 点击"保存"按钮保存修改
5. 点击"提交审查"进入审查流程

### 3. 审查案件
1. 点击"审查"按钮进入审查模式
2. 系统只显示已提交的标签页
3. 选择当前标签页
4. 点击"同意"或"不同意"按钮
5. 所有标签页同意后可点击"终了"

### 4. 导出案件
1. 点击"导出"按钮进入导出模式
2. 选择导出格式（Excel或PDF）
3. 点击对应导出按钮
4. 选择保存位置

### 5. 中止/恢复案件
1. 点击"中止"按钮中止案件
2. 中止后显示中止信息面板
3. 点击"恢复案件"可恢复

## 技术特点

### 1. 状态管理
- 使用状态模式管理6种不同的界面状态
- 每种状态有不同的控件权限和样式
- 状态转换有明确的业务规则

### 2. 数据绑定
- 使用控件的Tag属性绑定数据库字段
- 支持TextBox、ComboBox、CheckBox、DateTimePicker、RichTextBox等控件
- 自动提取和设置控件值

### 3. 审查流程
- 支持按标签页进行审查
- 记录完整的审查历史
- 只有所有标签页都同意才能终了

### 4. 错误处理
- 统一的异常处理机制
- 详细的错误日志记录
- 用户友好的错误提示

## 数据库设计

### 主要表结构
1. **Cases** - 案件基本信息
2. **CaseDetails** - 案件详细信息
3. **ReviewLogs** - 审查记录
4. **Users** - 用户信息

### 关键字段
- `CaseID` - 案件唯一标识
- `TabIndex` - 标签页索引（0-8）
- `FieldNo` - 字段编号
- `ReviewStatus` - 审查状态（同意/不同意/待审查等）

## 扩展说明

### 添加新标签页
1. 在`CreateTabPages()`方法中添加新的TabPage
2. 在`CreateTabContent()`方法中添加对应的控件创建逻辑
3. 在数据库中确保有对应的字段

### 添加新字段
1. 在对应的标签页中添加控件
2. 设置控件的Tag属性为字段名
3. 系统会自动处理数据绑定

### 添加新状态
1. 在`SetStatus()`方法中添加新状态的处理逻辑
2. 更新状态转换规则
3. 添加对应的界面样式

## 注意事项

1. **权限控制**：不同用户角色有不同的操作权限
2. **数据验证**：所有输入数据都会进行验证
3. **状态一致性**：确保案件状态与数据库记录一致
4. **性能优化**：大量数据时使用分页显示
5. **备份恢复**：重要操作前建议备份数据

## 故障排除

### 常见问题
1. **无法打开案件详细页面**
   - 检查案件ID是否存在
   - 确认数据库连接正常

2. **保存失败**
   - 检查数据库权限
   - 确认字段值格式正确

3. **审查流程异常**
   - 检查审查记录完整性
   - 确认用户权限

### 日志查看
- 错误日志保存在应用程序目录下
- 使用`LogUtil`类记录详细错误信息
- 可通过日志定位具体问题

## 联系支持

如有问题或建议，请联系开发团队。 