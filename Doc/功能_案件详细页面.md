# 功能设计：案件详细页面（阅览、编辑、审查、导出、中止、终了流程）

## 1. 功能描述
展示案件详细信息，支持多种状态（阅览、编辑、审查、导出、中止、终了），不同状态下界面和操作权限不同。

## 2. 功能实现流程
1. 用户通过案件一览或新建进入详细页面
2. 顶部图片按钮返回主页面，顶部状态按钮切换不同流程
3. 顶部中间显示案件类型、品种码、品种名、案件名、打开时间
4. 状态为"中止"时，案件名右侧显示红色"中止"标记
5. 主体为TabControl，9个TabPage（部分状态下隐藏）
6. Tab顶部左侧显示当前标签页状态
7. 不同状态下控件只读/可编辑/遮罩/隐藏
8. 支持Excel导入、保存、审查、导出、中止、终了等操作

## 3. 业务规则

### 3.1 阅览模式
- **控件状态**：所有控件只读
- **界面样式**：蓝色背景，无边框
- **操作权限**：仅可查看，无编辑权限
- **Tab显示**：显示所有标签页

### 3.2 编辑模式
- **控件状态**：未提交审查的标签页可编辑，已提交审查的标签页显示遮罩
- **界面样式**：白色背景，已提交审查的标签页显示半透明灰色遮罩
- **遮罩效果**：已提交审查的标签页显示"正在审查中"提示文字
- **操作权限**：可编辑未提交内容，可保存、提交审查
- **Tab显示**：显示所有标签页，已提交审查的标签页有遮罩层

### 3.3 审查模式
- **控件状态**：所有控件只读
- **界面样式**：淡紫色背景，项目级别颜色显示（白色/灰色/红色）
- **颜色规则**：
  - 白色：未审查项目
  - 灰色：已通过审查项目
  - 红色：同意后被重新编辑的项目
- **操作权限**：可进行同意/不同意审查操作
- **Tab显示**：仅显示已提交审查的标签页

### 3.4 导出模式
- **控件状态**：所有控件只读
- **界面样式**：白色背景
- **操作权限**：可导出Excel/PDF
- **Tab显示**：显示所有标签页

### 3.5 中止模式
- **控件状态**：隐藏TabControl
- **界面样式**：显示红色"中止"标记和中止信息面板
- **操作权限**：可恢复案件
- **Tab显示**：不显示标签页，显示中止信息

### 3.6 终了模式
- **控件状态**：所有控件只读
- **界面样式**：浅绿色背景
- **前置条件**：仅所有Tab同意后可终了
- **特殊规则**：memo/履历标签页有特殊显示规则
- **Tab显示**：显示所有标签页

## 4. 遮罩功能详细说明

### 4.1 遮罩触发条件
- 仅在编辑模式下显示
- 标签页有"待审查"状态的审查记录时触发

### 4.2 遮罩实现方式
- **遮罩层**：半透明灰色面板（透明度128，RGB: 200,200,200）
- **提示文字**："正在审查中"，深蓝色，14号粗体字
- **位置**：遮罩层左上角（50,50）位置
- **层级**：遮罩层位于所有控件之上

### 4.3 遮罩管理
- **添加遮罩**：`AddReviewingOverlays()`方法
- **清除遮罩**：`ClearReviewingOverlays()`方法
- **清除时机**：
  - 模式切换时
  - 数据重新加载时
  - 状态更新时

## 5. 使用角色
- **普通用户**：可进行阅览、编辑、保存操作
- **管理员**：拥有所有操作权限
- **审查人**：可进行审查操作（同意/不同意）

## 6. 界面设计要求
- 顶部图片按钮、状态按钮、信息区、红色中止标记
- TabControl，9个TabPage，Tab顶部状态提示
- 编辑模式下已提交审查标签页的半透明遮罩效果
- 审查模式下的项目级别颜色显示
- 参考[案件详细录入示例](./UIDesign/案件详细录入示例.html)

## 7. 技术实现要点

### 7.1 遮罩实现
```vb
' 创建遮罩面板
Dim overlayPanel As New Panel With {
    .Dock = DockStyle.Fill,
    .BackColor = Color.FromArgb(128, 200, 200, 200),
    .Visible = True,
    .Name = $"overlay_{tabIndex}"
}

' 添加提示文字
Dim lblReviewing As New Label With {
    .Text = "正在审查中",
    .Font = New Font("微软雅黑", 14, FontStyle.Bold),
    .ForeColor = Color.DarkBlue,
    .AutoSize = True,
    .Location = New Point(50, 50)
}
```

### 7.2 状态切换
- 每次状态切换时清除之前的遮罩
- 根据当前状态重新设置界面样式
- 更新按钮可用状态

### 7.3 数据同步
- 数据重新加载时清除遮罩
- 审查状态更新时重新设置遮罩
- 确保界面状态与数据状态一致 