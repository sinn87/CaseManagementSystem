# 数据库设计

## 1. 数据库选型
- Microsoft Access（.mdb/.accdb）

## 2. 主要表结构

### 2.1 用户表（Users）
| 字段名     | 类型         | 说明         |
|------------|--------------|--------------|
| UserID     | Text(20)     | 员工番号，主键 |
| Password   | Text(50)     | 密码（加密存储） |
| UserName   | Text(50)     | 用户姓名     |
| Role       | Text(20)     | 角色（管理员/普通用户） |
| Status     | Integer      | 状态（0-禁用，1-启用） |
| CreateTime | DateTime     | 创建时间     |

### 2.2 案件主表（Cases）
| 字段名         | 类型         | 说明         |
|----------------|--------------|--------------|
| CaseID         | AutoNumber   | 案件ID，主键 |
| CaseType       | Text(20)     | 案件类型     |
| CaseName       | Text(100)    | 案件名       |
| ProductCode    | Text(20)     | 品种码       |
| ProductName    | Text(50)     | 品种名       |
| Status         | Integer      | 状态         |
| PublishDate    | DateTime     | 发表日       |
| ListingDate    | DateTime     | 上场日       |
| CompanyRole    | Text(50)     | 公司角色     |
| LastUpdate     | DateTime     | 最新更新日   |
| IsTerminated   | Integer      | 中止登录状态 |
| ...            | ...          | ...          |

### 2.3 标签页字段映射表（TabFieldMapping）
| 字段名         | 类型         | 说明         |
|----------------|--------------|--------------|
| MappingID      | AutoNumber   | 主键         |
| TabIndex       | Integer      | 标签页编号   |
| FieldNo        | Text(20)     | 字段编号     |
| FieldName      | Text(50)     | 字段名称     |
| FieldType      | Text(20)     | 控件类型     |
| IsRequired     | Integer      | 是否必填     |
| DisplayOrder   | Integer      | 显示顺序     |
| CreateTime     | DateTime     | 创建时间     |

### 2.4 案件详细表（CaseDetails）
| 字段名         | 类型         | 说明         |
|----------------|--------------|--------------|
| DetailID       | AutoNumber   | 主键         |
| CaseID         | Integer      | 案件ID，外键 |
| FieldNo        | Text(20)     | 字段编号     |
| FieldValue     | Memo         | 字段值       |
| FieldStatus    | Text(20)     | 字段状态     |
| CreateTime     | DateTime     | 创建时间     |

### 2.5 审查记录表（ReviewLogs）
| 字段名         | 类型         | 说明         |
|----------------|--------------|--------------|
| ReviewID       | AutoNumber   | 主键         |
| CaseID         | Integer      | 案件ID，外键 |
| TabIndex       | Integer      | 标签页编号   |
| ReviewerID     | Text(20)     | 审查人ID     |
| ReviewStatus   | Text(20)     | 审查状态     |
| ReviewComment  | Memo         | 审查意见     |
| ReviewTime     | DateTime     | 审查时间     |

## 3. 表关系说明

### 3.1 主要关系
- **Cases** (1) ←→ (N) **CaseDetails** - 一个案件可以有多个详细字段
- **Cases** (1) ←→ (N) **ReviewLogs** - 一个案件可以有多个审查记录
- **TabFieldMapping** (1) ←→ (N) **CaseDetails** - 一个字段映射可以对应多个案件详情

### 3.2 字段关联逻辑
- `CaseDetails.FieldNo` 通过 `TabFieldMapping.FieldNo` 关联到对应的 `TabIndex`
- 审查记录按 `TabIndex` 进行，但实际数据存储在 `CaseDetails` 中
- 通过 `TabFieldMapping` 表可以知道每个标签页包含哪些字段

## 4. 主要索引与约束
- UserID唯一
- CaseID唯一
- TabFieldMapping中(TabIndex, FieldNo)组合唯一
- 外键约束：CaseDetails.CaseID → Cases.CaseID
- 外键约束：ReviewLogs.CaseID → Cases.CaseID

## 5. 数据流说明

### 5.1 案件录入流程
1. 创建案件主记录（Cases表）
2. 根据TabFieldMapping获取每个标签页的字段列表
3. 保存案件详细数据（CaseDetails表）

### 5.2 审查流程
1. 按标签页提交审查（ReviewLogs表）
2. 通过TabFieldMapping关联CaseDetails中的具体字段
3. 根据字段的修改时间判断是否需要重新审查

### 5.3 数据查询流程
1. 查询案件基本信息（Cases表）
2. 查询案件详细数据（CaseDetails表）
3. 通过TabFieldMapping组织标签页显示结构
4. 查询审查记录（ReviewLogs表）

## 6. 备份与恢复
- 定期备份Access数据库文件
- 重点保护TabFieldMapping表（系统配置表）
- 定期备份案件数据和审查记录

## 7. 示例数据

### 7.1 TabFieldMapping表示例
| TabIndex | FieldNo | FieldName | FieldType | IsRequired | DisplayOrder |
|----------|---------|-----------|-----------|------------|--------------|
| 0        | CaseNo  | 案件编号   | TextBox   | 1          | 1            |
| 0        | CaseName| 案件名称   | TextBox   | 1          | 2            |
| 0        | ApplyDate| 申请日期  | DateTimePicker | 1      | 3            |
| 1        | ProductCode| 产品代码 | TextBox   | 1          | 1            |
| 1        | ProductName| 产品名称 | TextBox   | 1          | 2            |
| 1        | ProductType| 产品类型 | ComboBox  | 0          | 3            |

### 7.2 CaseDetails表示例
| CaseID | FieldNo | FieldValue | FieldStatus | CreateTime |
|--------|---------|------------|-------------|------------|
| 1      | CaseNo  | C2024001   | 已保存      | 2024-01-01 |
| 1      | CaseName| 测试案件1   | 已保存      | 2024-01-01 |
| 1      | ProductCode| P001     | 已保存      | 2024-01-01 |

### 7.3 ReviewLogs表示例
| CaseID | TabIndex | ReviewerID | ReviewStatus | ReviewTime |
|--------|----------|------------|--------------|------------|
| 1      | 0        | user001    | 同意         | 2024-01-02 |
| 1      | 1        | user002    | 待审查       | 2024-01-02 | 